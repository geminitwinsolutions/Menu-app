<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doobie Division</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chewy&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-image: url('https://img1.wsimg.com/isteam/ip/9bf023f3-22a4-4b6a-90f6-78db1912c350/1000042893.png/:/rs=w:767,m'); background-size: cover; background-position: center; background-attachment: fixed; position: relative; }
        body::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: -1; }
        .icon { width: 24px; height: 24px; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .header-font { font-family: 'Chewy', sans-serif; }
        .subcategory-card.mrs-doobie { background-image: url('https://img1.wsimg.com/isteam/ip/9bf023f3-22a4-4b6a-90f6-78db1912c350/1000043503.jpg/:/cr=t:12.41%25,l:0%25,w:100%25,h:75.19%25/rs=w:720,h:541,cg:true'); background-size: cover; background-position: center; position: relative; color: white; transition: background-color: 0.3s; }
        .subcategory-card.doobie-division { background-image: url('https://img1.wsimg.com/isteam/ip/9bf023f3-22a4-4b6a-90f6-78db1912c350/1000042889.jpg/:/rs=w:200,h:200,cg:true,m/cr=w:200,h:200/qt=q:95'); background-size: cover; background-position: center; position: relative; color: white; transition: background-color: 0.3s; }
        .subcategory-card.general-sub { background-color: rgba(0, 0, 0, 0.7); position: relative; color: white; transition: background-color: 0.3s; }
        .subcategory-card.mrs-doobie:hover, .subcategory-card.doobie-division:hover, .subcategory-card.general-sub:hover { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.2), 0 4px 6px -2px rgba(0,0,0,0.1); }
        .subcategory-card.mrs-doobie::before, .subcategory-card.doobie-division::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1; transition: background-color: 0.3s; border-radius: 0.75rem; }
        .subcategory-card.mrs-doobie:hover::before, .subcategory-card.doobie-division:hover::before { background-color: rgba(0, 0, 0, 0.7); }
        .subcategory-card.general-sub::before { content: none; }
        .subcategory-card > * { position: relative; z-index: 2; }
        .app-link { cursor: pointer; }
        #cutoff-banner {
            position: sticky;
            top: 80px;
            background-color: #10B981;
            color: white;
            text-align: center;
            padding: 0.75rem;
            font-weight: 600;
            z-index: 45;
            transition: background-color 0.5s;
        }
        #cutoff-banner.closed {
            background-color: #EF4444;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">

    <header class="bg-black bg-opacity-70 backdrop-blur-sm sticky top-0 z-50 border-b border-white border-opacity-20">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <img src="https://img1.wsimg.com/isteam/ip/9bf023f3-22a4-4b6a-90f6-78db1912c350/1000042889.jpg/:/rs=w:200,h:200,cg:true,m/cr=w:200,h:200/qt=q:95" alt="Doobie Division Logo" class="h-10 w-10 rounded-full">
                <a href="#home" id="main-title" class="nav-link text-2xl font-bold text-white header-font">Doobie Division</a>
            </div>
            <nav id="desktop-nav" class="space-x-4 hidden md:flex items-center"></nav>
            <div class="md:hidden flex items-center space-x-2">
                <button id="cart-button-mobile" class="relative p-2 rounded-full hover:bg-white/10 transition-colors duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="icon text-gray-200"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 12.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
                    <span id="cart-count-mobile" class="absolute top-0 right-0 inline-flex items-center justify-center h-5 w-5 rounded-full bg-red-500 text-white text-xs font-bold transform translate-x-1/4 -translate-y-1/4 hidden">0</span>
                </button>
                <button id="mobile-menu-button" class="p-2 rounded-full hover:bg-white/10 transition-colors duration-300">
                    <svg id="menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="icon text-gray-200"><line x1="4" y1="12" x2="20" y2="12"></line><line x1="4" y1="6" x2="20" y2="6"></line><line x1="4" y1="18" x2="20" y2="18"></line></svg>
                    <svg id="close-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="icon text-gray-200 hidden"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
        </div>
    </header>

    <div id="cutoff-banner"></div>

    <div id="mobile-menu-overlay" class="md:hidden fixed top-20 left-0 w-full h-full bg-white shadow-md z-40 p-4 hidden">
        <nav id="mobile-nav" class="flex flex-col space-y-4"></nav>
    </div>

    <main id="main-content" class="container mx-auto px-4 py-8 flex-1"></main>

    <div id="cart-drawer" class="fixed top-0 right-0 w-full md:w-96 h-full bg-white shadow-2xl z-50 transform translate-x-full transition-transform duration-300 ease-in-out">
        <div class="p-6 h-full flex flex-col">
            <div class="flex justify-between items-center pb-4 border-b border-gray-200">
                <h2 class="text-2xl font-bold">Your Cart </h2>
                <button id="close-cart-button" class="p-2 rounded-full hover:bg-gray-100">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="icon text-gray-600"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <ul id="cart-items" class="flex-1 overflow-y-auto mt-4 space-y-4">
                <div id="empty-cart-message" class="text-center text-gray-500 py-8">Your cart is empty.</div>
            </ul>
            <div id="cart-summary" class="mt-6 border-t pt-4 hidden">
                <div class="flex justify-between items-center text-xl font-bold">
                    <span>Total:</span>
                    <span id="cart-total-price">$0.00</span>
                </div>
                <button id="checkout-button" class="w-full mt-4 bg-emerald-600 text-white font-semibold py-3 rounded-full shadow-md hover:bg-emerald-700 transition-colors duration-300">Checkout</button>
            </div>
        </div>
    </div>

    <footer class="bg-gray-900 text-white py-6 mt-auto">
        <div class="container mx-auto px-4 text-center text-sm">
            <p>&copy; 2025 Doobie Division. All rights reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tg = window.Telegram.WebApp;
            tg.ready(); 

            const user = tg.initDataUnsafe?.user;
            if (user) {
                document.getElementById('main-title').textContent = `Welcome, ${user.first_name}!`;
            }

            const API_URL = 'https://script.google.com/macros/s/AKfycbyb-NPrg0Ldq5YqMuAQ-Q9QaLJLpIX1-a-IJTvJkbo-mO_apjhN7uQXP0X9d7ohNqrbog/exec';
            
            const state = { products: [], deals: [], categories: {}, cart: [], currentPage: "home", isMobileMenuOpen: false, isCartOpen: false, };
            const mainContent = document.getElementById('main-content'); const cartItemsContainer = document.getElementById('cart-items'); const cartDrawer = document.getElementById('cart-drawer'); const cartCountMobile = document.getElementById('cart-count-mobile'); const cartTotal = document.getElementById('cart-total-price'); const cartSummary = document.getElementById('cart-summary'); const emptyCartMessage = document.getElementById('empty-cart-message'); const mobileMenuOverlay = document.getElementById('mobile-menu-overlay'); const menuIcon = document.getElementById('menu-icon'); const closeIcon = document.getElementById('close-icon'); const desktopNav = document.getElementById('desktop-nav'); const mobileNav = document.getElementById('mobile-nav');
            
            function handleOrderingCutoff() {
                const cutoffHour = 17; 
                const openingHour = 10;
                const banner = document.getElementById('cutoff-banner');
                if (!banner) return;
                function updateTimer() {
                    const now = new Date();
                    if (now.getHours() >= cutoffHour) {
                        banner.innerHTML = `Ordering is closed for the day. We re-open at ${openingHour}:00 AM.`;
                        banner.classList.add('closed');
                        document.querySelectorAll('.add-to-cart-btn, #checkout-button').forEach(btn => {
                            btn.disabled = true;
                            btn.style.opacity = '0.5';
                            btn.style.cursor = 'not-allowed';
                        });
                        return;
                    }
                    const cutoffTime = new Date(now);
                    cutoffTime.setHours(cutoffHour, 0, 0, 0);
                    const timeRemaining = cutoffTime - now;
                    const hours = Math.floor((timeRemaining / (1000 * 60 * 60)) % 24);
                    const minutes = Math.floor((timeRemaining / 1000 / 60) % 60);
                    const seconds = Math.floor((timeRemaining / 1000) % 60);
                    const formattedTime = [hours, minutes, seconds].map(n => n.toString().padStart(2, '0')).join(':');
                    banner.innerHTML = `Order within the next <strong>${formattedTime}</strong> to receive your delivery today!`;
                    banner.classList.remove('closed');
                }
                setInterval(updateTimer, 1000);
                updateTimer();
            }

            const fetchProductsAndRender = async () => { try { mainContent.innerHTML = `<div class="text-center text-white text-xl py-16">Loading Menu...</div>`; if (API_URL === 'PASTE_YOUR_API_URL_HERE') { mainContent.innerHTML = `<div class="text-center text-red-400 text-xl py-16">API URL is missing.</div>`; return; } const response = await fetch(API_URL); if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); const allData = await response.json(); state.products = allData['Menu/Products'] || []; state.deals = allData['Deals'] || []; if (state.products.length === 0 && state.deals.length === 0) { mainContent.innerHTML = `<div class="text-center text-yellow-300 text-xl py-16">No products are available on the menu right now. Please check back later.</div>`; renderMenuLinks(); return; } const categories = [...new Set(state.products.map(p => p.productCategory))]; state.categories = {}; categories.forEach(cat => { state.categories[cat] = { description: `Explore our selection of ${cat.toLowerCase()}.` }; }); handlePageChange(window.location.hash ? window.location.hash.substring(1) : "home"); renderMenuLinks(); renderCart(); } catch (error) { console.error("Failed to fetch product data:", error); mainContent.innerHTML = `<div class="text-center text-red-500 text-xl py-16">Failed to load menu. Please try again later.</div>`; } };
            const handlePageChange = (page) => { state.currentPage = page || "home"; window.location.hash = state.currentPage; renderCurrentPage(); };
            const renderHomePage = () => { let dealsHtml = ''; if (state.deals && state.deals.length > 0) { dealsHtml = ` <div class="mt-16"> <h2 class="text-3xl md:text-4xl font-bold text-white text-center mb-8 header-font"> Today's Deals! </h2> <div class="grid md:grid-cols-2 gap-8"> ${state.deals.map(deal => ` <div class="bg-gray-800 bg-opacity-75 p-6 rounded-lg border-2 border-dashed border-yellow-400 text-center transform hover:scale-105 transition-transform duration-300"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-12 h-12 mx-auto mb-4 text-yellow-400"> <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/> </svg> <p class="font-semibold text-gray-300 uppercase tracking-wider mb-2">${deal.categoryDeals} Deal</p> <p class="text-3xl font-bold text-white header-font">${deal.productDeals}</p> </div> `).join('')} </div> </div> `; } mainContent.innerHTML = ` <div class="flex flex-col items-center justify-center py-12 px-4"> <div class="bg-black bg-opacity-70 backdrop-blur-sm rounded-xl shadow-lg border border-white border-opacity-20 p-8 md:p-12 max-w-3xl mx-auto text-center"> <h1 class="text-4xl md:text-5xl font-bold text-white leading-tight mb-4 header-font"> Welcome to Doobie Division </h1> <p class="text-lg md:text-xl text-gray-200 max-w-2xl mx-auto mb-8"> Your premier source for high-quality products. Feel free to browse our menu or check out our ordering info and rules. </p> <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4"> <a href="#menu" class="nav-link inline-block bg-emerald-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-emerald-700 transition-colors duration-300"> View Today's Menu </a> <a href="#info" class="nav-link inline-block bg-gray-200 text-gray-800 font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-gray-300 transition-colors duration-300"> Ordering Information </a> </div> </div> ${dealsHtml} </div> `; document.title = "Doobie Division - Home"; };
            const renderMenuPage = () => { const categories = Object.keys(state.categories); let categoryCardHtml = categories.map(category => ` <a href="#subcategories/${encodeURIComponent(category)}" class="app-link w-full text-left p-6 bg-black bg-opacity-70 backdrop-blur-sm text-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 flex flex-col items-start border border-white border-opacity-20"> <h3 class="text-2xl font-bold">${category}</h3> <p class="text-gray-300">${state.categories[category].description}</p> </a> `).join(''); mainContent.innerHTML = ` <h1 class="text-4xl md:text-5xl font-bold text-white text-center mb-8"> All Categories </h1> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"> ${categoryCardHtml} </div> `; document.title = "Doobie Division - Menu"; };
            const renderSubcategoriesPage = (category) => { const subcategories = [...new Set(state.products.filter(p => p.productCategory === category).map(p => p.productSubCategory))]; const subcategoryCardHtml = subcategories.map(subcategory => { const isMrsDoobie = subcategory.toLowerCase().includes("mrs. doobie"); const isDoobieDivision = subcategory.toLowerCase().includes("doobie division"); const cardClass = isMrsDoobie ? 'mrs-doobie' : isDoobieDivision ? 'doobie-division' : 'general-sub'; return ` <a href="#products/${encodeURIComponent(category)}/${encodeURIComponent(subcategory)}" class="app-link subcategory-card w-full text-left p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 flex flex-col items-start relative overflow-hidden border border-white border-opacity-20 ${cardClass}"> <div class="relative z-10 flex flex-col items-start"> <h3 class="text-2xl font-bold">${subcategory}</h3> <p class="text-sm font-medium">Explore products in this category.</p> </div> </a> `; }).join(''); const backLink = ` <div class="flex items-center mb-8"> <a href="#menu" class="app-link text-emerald-300 font-semibold flex items-center space-x-2 hover:text-emerald-500 transition-colors duration-300"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left"><path d="m15 18-6-6 6-6"/></svg> <span>Back to All Categories</span> </a> </div> `; mainContent.innerHTML = ` ${backLink} <h1 class="text-4xl md:text-5xl font-bold text-white text-center mb-8"> ${category} </h1> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"> ${subcategoryCardHtml} </div> `; document.title = `Doobie Division - ${category}`; };
            const renderProductsPage = (category, subcategory) => { const filteredProducts = state.products.filter(p => p.productCategory === category && p.productSubCategory === subcategory); let productGridHtml = ''; if (filteredProducts.length === 0) { productGridHtml = `<div class="text-center text-gray-300 text-xl py-16">No products available in this subcategory.</div>`; } else { productGridHtml = `<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">${filteredProducts.map(product => { const priceKeys = Object.keys(product.prices); const hasPriceOptions = priceKeys.length > 1; const priceDisplay = hasPriceOptions ? `<select class="price-select bg-gray-700 border border-gray-600 rounded-lg p-2 text-md font-semibold text-white" data-product-id="${product.productId}">${priceKeys.map(key => `<option value="${key}">${key} ($${product.prices[key].toFixed(2)})</option>`).join('')}</select>` : `<span class="text-2xl font-semibold text-emerald-400">${priceKeys.length > 0 ? `$${product.prices[priceKeys[0]].toFixed(2)}` : 'N/A'}</span>`; let optionDisplay = ''; if (product.availableOptionsList && product.availableOptionsList.length > 0) { optionDisplay = `<div class="w-full my-2 text-left space-y-2"><h3 class='text-md font-bold text-emerald-400 mb-2'>Available Options</h3><div class="flex flex-col space-y-1 pl-2">`; product.availableOptionsList.sort((a,b) => a[0].subType.localeCompare(b[0].subType)).forEach(optionGroup => { const label = optionGroup.map(opt => `${opt.name} (${opt.subType})`).join(' / '); const value = label; optionDisplay += `<label class="flex items-center space-x-2 text-sm cursor-pointer"><input type="radio" name="option-select-${product.productId}" value="${value}" class="option-select form-radio bg-gray-700 border-gray-600 text-emerald-500 focus:ring-emerald-500"><span>${label}</span></label>`; }); optionDisplay += `</div></div>`; } else { optionDisplay = `<p class="text-sm font-medium text-gray-300 mb-2">${product.productSubCategory}</p>`; } return `<div class="bg-black bg-opacity-70 backdrop-blur-sm rounded-xl shadow-lg flex flex-col p-4 text-white border border-white/20"><img src="${product.imageUrls ? product.imageUrls.split(',')[0].trim() : 'https://placehold.co/400x300/333333/888888?text=Image+Unavailable'}" alt="${product.productName}" class="w-full h-48 object-cover rounded-md mb-4" onerror="this.onerror=null;this.src='https://placehold.co/400x300/333333/888888?text=Image+Unavailable';"/><div class="flex flex-col items-center text-center w-full flex-grow"><h3 class="text-xl font-bold text-white">${product.productName}</h3>${optionDisplay}<p class="text-sm text-gray-200 my-4 text-center px-2 flex-grow">${product.productDescription2 || ''}</p></div><div class="flex justify-between items-center w-full px-2 mt-auto">${priceDisplay}<button class="add-to-cart-btn bg-emerald-600 text-white font-semibold py-2 px-6 rounded-full shadow-md hover:bg-emerald-700" data-product-id="${product.productId}">Add</button></div></d
